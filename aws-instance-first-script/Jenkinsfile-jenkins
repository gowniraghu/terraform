pipeline {
    agent any
    environment {
            AWS_ACCESS_KEY_ID     = credentials('AWS_ACCESS_KEY')
            AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY')
            AWS_DEFAULT_REGION    = 'ap-south-1'
            ENVIRONMENTS_PATH     = "aws-instance-first-script"
        }
    stages {
        stage('Checkout code') {
            steps {
                cleanWs()
                checkout scm
            }
        }

        stage('Create Terraform Plan for Environment') {
            steps{
                        sh "cp ${ENVIRONMENTS_PATH}/aws-instance-example.tf aws-instance-example.tf"
                        sh "terraform get"
                    }
                }
            }

        stage('Apply terraform plan') {
                    sh "terraform apply"
                }
            }
